<html><head><link rel="import" href="../iron-form/iron-form.html">

</head><body><dom-module id="callback-form">
    <template>
        <style>:host{display:block;}</style>
        <!--suppress HtmlUnknownTarget -->
        <form is="iron-form" action="[[action]]" method="post" id="callbackForm">
            <slot></slot>
        </form>
    </template>
    <script>Polymer({is:"callback-form",properties:{action:String,errorMessage:{type:String,value:"Произошла ошибка. Попробуйте отправить вашу заявку позднее."},submitMessage:{type:String,value:"Заявка успешно отправлена!"},submitBtn:Object,display:Object,formData:Object},ready:function(){return this.submitBtn=this.querySelector('[type="submit"]'),null==this.submitBtn&&(this.submitBtn=this.querySelector('button:not([type="button"])')),null==this.submitBtn?console.error("Can't find submit button"):this.display=this.submitBtn.parentNode,this.listen(this.$.callbackForm,"iron-form-submit","onSubmit"),this.listen(this.$.callbackForm,"iron-form-error","onError"),this.listen(this.$.callbackForm,"iron-form-response","onResponse")},onSubmit:function(){var t,s,e,i;for(this.formData=this.$.callbackForm.serialize(),this.submitBtn.textContent=this.submitBtn.getAttribute("data-loading-text"),i=this.querySelectorAll("[name]"),t=0,e=i.length;t<e;t++)s=i[t],this.isLightDescendant(s)&&(s.disabled=!0);return this.submitBtn.disabled=!0},onError:function(){return this.prepareForMessage(),this.display.textContent=this.errorMessage,this.toggleClass("alert-danger",!0,this.display),this.fire("callback-form-sending-error",{formData:this.formData})},onResponse:function(t){return this.prepareForMessage(),t.detail.response&&t.detail.response.message&&(this.submitMessage=t.detail.response.message),this.display.textContent=this.submitMessage,this.toggleClass("alert-success",!0,this.display),this.fire("callback-form-sending-success",{formData:this.formData})},prepareForMessage:function(){return this.display.removeChild(this.submitBtn),this.toggleClass("alert",!0,this.display)},submit:function(){this.$.callbackForm.submit()}});</script>
</dom-module></body></html>